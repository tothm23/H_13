package robotharc;

/**
 *
 * @author Paksi Norbert
 */
import java.util.ArrayList;
import java.util.Random;
import robotharc.Felszereles.Fegyver;
import robotharc.Felszereles.Pancel;
import robotharc.Hiba.RobotHiba;

public abstract class Robot {

    protected String nev;
    protected Szin szin;
    protected Integer eletero;
    protected int maxEletero;
    protected boolean harcose;
    protected Integer ero;
    protected Integer vedelem;

    // p√°nc√©l/v√©delmi pont (nem musz√°ly, leht 0))
    // t√°rgyak
    protected Fegyver fegyver;
    protected Pancel pancel;

    public Robot(String nev, Szin szin, Integer eletero, Boolean harcose, Integer sebzes, Integer vedelem, Fegyver fegyver, Pancel pancel) throws RobotHiba {
        if (nev.equalsIgnoreCase("")) {
            throw new RobotHiba("A robot neve nem lehet √ºres!");
        }
        this.nev = nev;
        this.szin = szin;

        // bemen≈ë param√©ter + p√°nc√©l √°lltal adott √©leter≈ë
        this.eletero = eletero + pancel.getEletero();

        this.maxEletero = eletero;
        this.harcose = harcose;
        this.ero = sebzes;

        // bemen≈ë param√©ter + p√°nc√©l √°lltal adott v√©delem
        this.vedelem = vedelem + pancel.getVedelem();

        this.fegyver = fegyver;
        this.pancel = pancel;
    }

    public String getNev() {
        return nev;
    }

    public void setNev(String nev) throws RobotHiba {
        if (nev.equalsIgnoreCase("")) {
            throw new RobotHiba("A robot neve nem lehet √ºres!");
        }
        this.nev = nev;
    }

    public Szin getSzin() {
        return szin;
    }

    public void setSzin(Szin szin) {
        this.szin = szin;
    }

    public int getEletero() {
        return eletero;
    }

    public void setEletero(int eletero) {
        this.eletero = eletero;
    }

    public int getMaxEletero() {
        return maxEletero;
    }

    public void setMaxEletero(int maxEletero) {
        this.maxEletero = maxEletero;
    }

    public boolean isHarcose() {
        return harcose;
    }

    public void setHarcose(boolean harcose) {
        this.harcose = harcose;
    }

    public int getEro() {
        return ero;
    }

    public void setEro(int sebzes) {
        this.ero = sebzes;
    }

    public Integer getVedelem() {
        return vedelem;
    }

    public void setVedelem(Integer vedelem) {
        this.vedelem = vedelem;
    }

    /**
     * Meg√°llap√≠tja, hogy mindk√©t robot harcos-e
     *
     * @param robot1
     * @param robot2
     * @return
     */
    public static boolean Harcosok(Robot robot1, Robot robot2) {
        return robot1.harcose && robot2.harcose;
    }

    /**
     * Kisorsoljuk a kezd≈ë robotot
     *
     * @param robot1
     * @param robot2
     * @return
     */
    public static Robot Kezdorobot(Robot robot1, Robot robot2) {
        /*
        Vizsg√°latok sz√°ma
        if (robot1.eletero > robot2.eletero) { // 1. vizsg√°lat
            return "robot2";
        } else if (robot1.eletero < robot2.eletero) { // 2. vizsg√°lat
            return "robot1";
        } else {
            if (robot1.ero > robot2.ero) { // 3. vizsg√°lat
                return "robot1";
            } else if (robot1.ero < robot2.ero) { // 4. vizsg√°lat
                return "robot2";
            } else {
                int szam1 = randomszam();
                int szam2 = randomszam();
                if (szam1 > szam2) {
                    return "robot1"; // 5. vizsg√°lat
                } else {
                    return "robot2"; // 5. vizsg√°lat
                }

            }
        }
         */

        if ((robot2.eletero > robot1.eletero)
                || (robot1.eletero.equals(robot2.eletero)) && robot1.ero > robot2.ero
                || (robot1.eletero.equals(robot2.eletero)) && robot1.ero.equals(robot2.ero) && Robot.randomszam(2) == 0) {
            return robot1; // 1 vagy 3 vizsg√°lat
        } else {
            return robot2; // 1 vagy 3 vizsg√°lat
        }
    }

    /**
     * Visszaad egy eg√©sz sz√°mot
     *
     * @param max
     * @return
     */
    public static int randomszam(int max) {
        // nextInt(10) 0-9
        return new Random().nextInt(max);
    }

    /**
     * Visszaad egy eg√©sz sz√°mot a megadott tartom√°ny szerint
     *
     * @param tol
     * @param ig
     * @return
     */
    public static int veletlenEgeszSzam(int tol, int ig) {
        return (int) Math.floor(Math.random() * (ig - tol + 1) + tol);
    }

    /**
     * A robotok sebzik egym√°st
     *
     * @return
     */
    public int sebzes() {
        //return randomszam(this.ero + 1);

        // Fegyver miatt megv√°ltoztatott verzi√≥
        int sebzes = randomszam(this.ero + 1);  // 0 √©s karakter k√∂z√∂tti random sz√°m gener√°l√°s
        sebzes += this.fegyver.getEro();    // A kor√°bbi √©rt√©khez hozz√°adjuk a fegyver er≈ë tulajdons√°g√°t

        int max = this.fegyver.getMaximumSebzes();  // 18
        int min = this.fegyver.getMinimumSebzes();  // 12  
        int tartomany = max - min;  // 6

        int fegyverSebzes = randomszam(tartomany + 1);  // 0-6
        fegyverSebzes += min;   // 0-6 + 12 -> 12 - 18

        sebzes += fegyverSebzes;   // Az er≈ë √©rt√©kekb≈ël sz√°molt fix sebz√©shez hozz√°adjuk a fegyverb≈ël gener√°lt random sebz√©st
        // System.out.println("Min: " + min + " MAx: " + max + " fegyver sebz√©se: " + fegyversebzes + " Teljes sebz√©s: " + sebzes);

        return sebzes;
    }

    /**
     * A kezd≈ë robot megt√°madja a m√°sikat, majd ford√≠tva
     *
     * @param szenvedo
     */
    public void Tamadas(Robot szenvedo) {

        // A t√°mad√≥ robot
        int sebzes = this.sebzes(); //12
        int vedelem = szenvedo.getVedelem(); // 8

        // Ezt k√ºl√∂n kell t√°rolni, mert a Gy√≥gyul√°shoz kell
        int tenylegesSebzes = sebzes - vedelem;

        // Nem engedj√ºk, hogy -okat sebezzen
        if (tenylegesSebzes < 0) {
            tenylegesSebzes = 0;
        }

        // V√©dekez≈ë robot p√°nc√©l/ v√©delmi pont √©rt√©k√©nek kisz√°mol√°sa (p√°nc√©l ltulajdons√°g + p√°nc√©l t√°rgy v√©delme)
        System.out.print(Szin.SARGA.get() + "üî• " + Szin.VISSZA.get() + szin.get() + this.nev + Szin.VISSZA.get() + " megt√°madja " + szenvedo.getSzin().get() + szenvedo.nev + Szin.VISSZA.get() + " √©s " + tenylegesSebzes + " sebz√©st okoz");

        if (szenvedo.getEletero() >= 0) {
            // Nem a sebz√©s, hanem a sebz√©s - p√°nc√©l √©rt√©ket vonjuk ki
            szenvedo.setEletero(szenvedo.getEletero() - (sebzes - szenvedo.pancel.getVedelem())); // 30-4

            // A p√°nc√©l tartoss√°g√°b√≥l lej√∂n a kiv√©dett sebz√©s √©rt√©ke
            // szenvedo.pancel.setTartossag(szenvedo.pancel.getTartossag() - szenvedo.pancel.getVedelem());
        } else {

        }

        System.out.println(" " + szenvedo.getSzin().get() + szenvedo.nev + Szin.VISSZA.get() + " √©letereje " + szenvedo.getEletero() + " lett");

        // Minden t√°mad√°s ut√°n gy√≥gyulnak a robotok
        Gyogyulas(sebzes);
    }

    /**
     * Minden t√°mad√°s ut√°n gy√≥gyulnak a robotok
     *
     * @param sebzes
     */
    public void Gyogyulas(int sebzes) {
        if (sebzes == this.ero) {
            // Aktu√°lis √©let lehet t√∂bb mint a max √©let, ez√©ret a max√©let + p√°nc√©l √©letereje √©rt√©kkel kell dolgozni
            this.setEletero(this.getEletero() + 2); // Max 40, Aktu√°lis 48

            if (this.eletero > this.maxEletero) {
                this.eletero = this.maxEletero;
            }
            System.out.println("\nüñ§ " + szin.get() + this.nev + Szin.VISSZA.get() + " maxim√°lisat sebzett, ez√©rt gy√≥gyult. √öj √©letereje: " + this.eletero + "\n");
        }

    }

    /**
     * A harc, ami az egyik robot hal√°l√°ig tart
     *
     * @param robot1
     * @param robot2
     */
    public static void Harc(Robot robot1, Robot robot2) {
        // Akkor harcolnak egym√°ssal, ha mindk√©t robot harcos
        if (Harcosok(robot1, robot2)) {

            Robot kezdorobot = Kezdorobot(robot1, robot2);
            boolean jatek = true;

            while (jatek) {
                if (kezdorobot.equals(robot1)) {
                    robot1.Tamadas(robot2);
                    if (robot2.eletero <= 0 || robot1.eletero <= 0) {
                        System.out.println(Szin.SARGA.get() + "\nüèÜ " + Szin.VISSZA.get() + "A bajnok nem m√°s, mint " + robot1.getSzin().get() + robot1.getNev() + Szin.VISSZA.get() + "! \n");
                        jatek = false;
                    } else {
                        robot2.Tamadas(robot1);
                    }

                } else {
                    robot2.Tamadas(robot1);
                    if (robot1.eletero <= 0 || robot2.eletero <= 0) {
                        System.out.println(Szin.SARGA.get() + "\nüèÜ " + Szin.VISSZA.get() + "A bajnok nem m√°s, mint " + robot1.getSzin().get() + robot2.getNev() + Szin.VISSZA.get() + "! \n");
                        jatek = false;
                    } else {
                        robot1.Tamadas(robot2);
                    }

                }

            }

        } else {
            System.out.println("Az egyik robot nem harcos.");
            System.exit(0);
        }
    }

    /**
     * Meg√°llap√≠tja a jelenlegi fordul≈ë gy≈ëztes√©t
     *
     * @param robot1
     * @param robot2
     * @return
     */
    public static Robot Gyoztes(Robot robot1, Robot robot2) {

        if (Harcosok(robot1, robot2)) {

            Robot kezdorobot = Kezdorobot(robot1, robot2);
            boolean jatek = true;

            while (jatek) {
                if (kezdorobot.equals(robot1)) {
                    robot1.Tamadas(robot2);

                    if (robot2.getEletero() <= 0) {
                        jatek = false;
                        return robot1;
                    } else {
                        robot2.Tamadas(robot1);
                    }

                } else {
                    robot2.Tamadas(robot1);

                    if (robot1.getEletero() <= 0) {
                        jatek = false;
                        return robot2;
                    } else {
                        robot1.Tamadas(robot2);
                    }

                }

            }

        } else {
            System.out.println("Az egyik robot nem harcos.");
            System.exit(0);
        }

        return null;

    }

    /**
     * Bajnoks√°g, 8 robot k√∂z√∂tt
     *
     * @param robotok
     */
    public static void Robotbajnoksag(ArrayList<Robot> robotok) {

        boolean bajnoksag = true;

        for (Robot robot : robotok) {

            // Ha van ak√°r 1 olyan robot, amelyik nem harcos
            if (!robot.isHarcose()) {

                // Akkor nem lesz bajnoks√°g
                bajnoksag = false;
            }
        }
        // Csak akkor lehet bajnoks√°g, ha minden robot harcos
        if (bajnoksag) {
            // A robotok akik bejutottak al el≈ëd√∂nt≈ëbe 5 √©letet kapnak
            Robot elodontosA = Gyoztes(robotok.get(0), robotok.get(1));
            elodontosA.setEletero(elodontosA.getEletero() + 5);
            System.out.println("\nüèÜ  Az 1. el≈ëd√∂nt≈ës " + elodontosA.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + elodontosA.getEletero() + " lett\n");

            Robot elodontosB = Gyoztes(robotok.get(2), robotok.get(3));
            elodontosB.setEletero(elodontosB.getEletero() + 5);
            System.out.println("\nüèÜ A 2. el≈ëd√∂nt≈ës " + elodontosB.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + elodontosB.getEletero() + " lett\n");

            Robot elodontosC = Gyoztes(robotok.get(4), robotok.get(5));
            elodontosC.setEletero(elodontosC.getEletero() + 5);
            System.out.println("\nüèÜ A 3. el≈ëd√∂nt≈ës " + elodontosC.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + elodontosC.getEletero() + " lett\n");

            Robot elodontosD = Gyoztes(robotok.get(6), robotok.get(7));
            elodontosD.setEletero(elodontosD.getEletero() + 5);
            System.out.println("\nüèÜ A 4. el≈ëd√∂nt≈ës " + elodontosD.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + elodontosD.getEletero() + " lett\n");

            // A robotok akik bejutottak al d√∂nt≈ëbe 5 √©letet kapnak
            Robot dontosA = Gyoztes(elodontosA, elodontosB);
            dontosA.setEletero(dontosA.getEletero() + 5);
            System.out.println("\nüèÜ Az 1. d√∂nt≈ës " + dontosA.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + dontosA.getEletero() + " lett\n");

            Robot dontosB = Gyoztes(elodontosC, elodontosD);
            dontosB.setEletero(dontosB.getEletero() + 5);
            System.out.println("\nüèÜ A 2. d√∂nt≈ës " + dontosB.getNev() + ", aki kap 5 √©leter≈ët, √≠gy √©letereje " + dontosB.getEletero() + " lett\n");

            Robot gyoztes = Gyoztes(dontosA, dontosB);

            System.out.println("\nüèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ");
            System.out.println("üèÜ  A bajnok nem m√°s, mint " + gyoztes.getNev() + " !  üèÜ");
            System.out.println("üèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ üèÜüèÜüèÜüèÜüèÜ\n");
        }

    }

}
